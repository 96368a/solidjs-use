import{O as j,q as b,H as h,u as z,Z as T}from"./index-60a4a5ae.js";import{w as E}from"./index-e8ae8a1e.js";import{n as V}from"./scheduler-3ae68f06.js";import{u as F}from"./index-c1a3c0b1.js";const g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p="__solidjs-use_ssr_handlers__";g[p]=g[p]??{};const W=g[p];function x(e,s){return W[e]??s}function H(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const M={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}};function P(e,s,n,m={}){const{listenToStorageChanges:N=!0,writeDefaults:A=!0,mergeDefaults:c=!1,window:l=b,eventFilter:O,onError:d=r=>{console.error(r)}}=m,[o,u]=j(s);if(!n)try{n=x("getDefaultStorage",()=>b?.localStorage)()}catch(r){d(r)}if(!n)return h(s)?o:[o,u];const a=z(s),S=H(a),f=m.serializer??M[S],{pause:_,resume:w}=E(o,()=>D(o()),{eventFilter:O,defer:!1});return l&&N&&F(l,"storage",y),y(),h(s)?o:[o,u];function D(r){try{if(r==null)n.removeItem(e);else{const t=f.write(r),i=n.getItem(e);i!==t&&(n.setItem(e,t),l&&l?.dispatchEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:t,storageArea:n})))}}catch(t){d(t)}}function J(r){const t=r?r.newValue:n.getItem(e);if(t==null)return A&&a!==null&&n.setItem(e,f.write(a)),a;if(!r&&c){const i=f.read(t);return T(c)?c(i,a):S==="object"&&!Array.isArray(i)?{...a,...i}:i}else if(typeof t!="string")return t;return f.read(t)}function y(r){if(!(r&&r.storageArea!==n)){if(r&&r.key==null){u(()=>a);return}if(!(r&&r.key!==e)){_();try{u(J(r))}catch(t){d(t)}finally{r?V(w):w()}}}}}export{x as g,P as u};
